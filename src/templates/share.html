<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ü–æ–î–ï–õ–ò! - –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —á–µ–∫–æ–º</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="share-page-body">

    <div class="header">
        <div class="logo">–ü–æ–î–ï–õ–ò!</div>
        <div>–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—É–º–º–æ–π –∏–∑ —á–µ–∫–∞ –ª–µ–≥–∫–æ</div>
    </div>

    <!-- <<< –ù–û–í–ê–Ø –û–ë–ï–†–¢–ö–ê –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ >>> -->
    <div class="share-widgets-wrapper">

        <!-- –ü–µ—Ä–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞: –°—É–º–º–∞ —á–µ–∫–∞ -->
        <div class="container receipt-container">
            <div class="container-content receipt-content">
                <div class="receipt-title">–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É —á–µ–∫–∞</div>
                <div class="amount-container">
                     <input type="text" inputmode="decimal" id="receiptAmountInput" value="0.00" placeholder="0.00">
                     <span class="currency-symbol">‚ÇΩ</span>
                </div>
            </div>
        </div>
        <!-- <<< –ù–û–í–´–ô –ë–õ–û–ö: –ü–æ—Å–ª–µ–¥–Ω—è—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è —Å—É–º–º–∞ >>> -->
        <div class="container last-amount-container" id="lastAmountCard" style="display: none;"> <!-- –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
            <div class="container-content last-amount-content">
                <div class="last-amount-title">–ü–æ—Å–ª–µ–¥–Ω—è—è —Å—É–º–º–∞ –∏–∑ —á–µ–∫–∞</div>
                <div class="last-amount-value-wrapper">
                    <span id="lastAmountDisplay" class="last-amount-value">0.00</span>
                    <span class="currency-symbol">‚ÇΩ</span>
                </div>
                <!-- –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ -->
                <div class="last-amount-button-wrapper">
                     <button id="copyLastAmountBtn" class="result-action-btn copy-last-amount-btn" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—É–º–º—É">
                         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                     </button>
                </div>
            </div>
        </div>
        <!-- <<< –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ë–õ–û–ö–ê >>> -->
        <!-- –í—Ç–æ—Ä–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞: –ö–Ω–æ–ø–∫–∏ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è -->
        <div class="container share-container">
            <div class="container-content share-content">
                <div class="share-title">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—É–º–º–æ–π</div>
                <div class="share-buttons">
                    <!-- VK Button -->
                    <button class="share-button" id="shareVk">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                            <path d="M15.07 2H8.93C3.33 2 2 3.33 2 8.93V15.07C2 20.67 3.33 22 8.93 22H15.07C20.67 22 22 20.67 22 15.07V8.93C22 3.33 20.67 2 15.07 2M18.15 16.27H16.69C16.14 16.27 15.97 15.82 15 14.83C14.12 13.94 13.74 13.71 13.53 13.71C13.24 13.71 13.15 13.83 13.15 14.38V15.69C13.15 16.04 13.04 16.26 12.11 16.26C10.57 16.26 8.86 15.32 7.66 13.59C5.85 11.05 5.36 9.13 5.36 8.75C5.36 8.54 5.43 8.34 5.85 8.34H7.32C7.69 8.34 7.83 8.5 7.97 8.9C8.69 11 9.89 12.8 10.38 12.8C10.57 12.8 10.65 12.71 10.65 12.25V10.1C10.6 9.12 10.07 9.03 10.07 8.68C10.07 8.5 10.21 8.34 10.44 8.34H12.73C13.04 8.34 13.15 8.5 13.15 8.88V11.77C13.15 12.08 13.28 12.19 13.38 12.19C13.56 12.19 13.72 12.08 14.05 11.74C15.1 10.57 15.85 8.76 15.85 8.76C15.95 8.55 16.11 8.35 16.5 8.35H17.93C18.37 8.35 18.47 8.58 18.37 8.89C18.19 9.74 16.41 12.25 16.43 12.25C16.27 12.5 16.21 12.61 16.43 12.9C16.58 13.11 17.09 13.55 17.43 13.94C18.05 14.65 18.53 15.24 18.66 15.65C18.77 16.06 18.57 16.27 18.15 16.27Z"/>
                        </svg>
                        –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
                    </button>
                    <!-- Telegram Button -->
                    <button class="share-button" id="shareTelegram">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                            <path d="M9.78,18.65L10.06,14.42L17.74,7.5C18.08,7.19 17.67,7.04 17.22,7.31L7.74,13.3L3.64,12C2.76,11.75 2.75,11.14 3.84,10.7L19.81,4.54C20.54,4.21 21.24,4.72 20.96,5.84L18.24,18.65C18.05,19.56 17.5,19.78 16.74,19.36L12.6,16.3L10.61,18.23C10.38,18.46 10.19,18.65 9.78,18.65Z"/>
                        </svg>
                        Telegram
                    </button>
                </div>
            </div>
        </div>

    </div> <!-- <<< –ö–û–ù–ï–¶ –ù–û–í–û–ô –û–ë–ï–†–¢–ö–ò >>> -->

    <script>
        // Get references to elements
        const amountInput = document.getElementById('receiptAmountInput');
        const shareVkButton = document.getElementById('shareVk');
        const shareTelegramButton = document.getElementById('shareTelegram');
        // --- –ù–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—É–º–º—ã ---
        const lastAmountCard = document.getElementById('lastAmountCard');
        const lastAmountDisplay = document.getElementById('lastAmountDisplay');
        const copyLastAmountButton = document.getElementById('copyLastAmountBtn');
        const LAST_PROCESSED_AMOUNT_KEY = 'lastProcessedTotalAmount_v1'; // –¢–æ—Ç –∂–µ –∫–ª—é—á, —á—Ç–æ –∏ –≤ index.html
        // --- –ö–æ–Ω–µ—Ü –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ --

        // –§—É–Ω–∫—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞: —É–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–±–µ–ª—ã, –∑–∞–º–µ–Ω—è–µ—Ç –∑–∞–ø—è—Ç—É—é, —É–¥–∞–ª—è–µ—Ç –º—É—Å–æ—Ä
        function parseAmount(text) {
            if (text === null || text === undefined || text === '') return null;
            // 1. –£–±—Ä–∞—Ç—å –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã
            // 2. –ó–∞–º–µ–Ω–∏—Ç—å –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É
            // 3. –£–¥–∞–ª–∏—Ç—å –≤—Å–µ, –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä –∏ –æ–¥–Ω–æ–π —Ç–æ—á–∫–∏
            let cleanedText = String(text)
                .replace(/\s+/g, '')     // –£–±–∏—Ä–∞–µ–º –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã (–≤–∫–ª—é—á–∞—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ)
                .replace(',', '.');     // –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É

            // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –∏ –ø–µ—Ä–≤—É—é —Ç–æ—á–∫—É
            const parts = cleanedText.split('.');
            let finalCleanedText = parts[0].replace(/[^0-9]/g, ''); // –û—á–∏—â–∞–µ–º —Ü–µ–ª—É—é —á–∞—Å—Ç—å

            if (parts.length > 1) {
                // –û—á–∏—â–∞–µ–º –¥—Ä–æ–±–Ω—É—é —á–∞—Å—Ç—å (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã) –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫—É
                finalCleanedText += '.' + parts.slice(1).join('').replace(/[^0-9]/g, '');
            }

             // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è –≤–≤–æ–¥–∞ –ø—Ä–æ—Å—Ç–æ "."
             if (finalCleanedText === '.') return 0;

            const value = parseFloat(finalCleanedText);
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º null –µ—Å–ª–∏ NaN –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ
            return isNaN(value) || value < 0 ? null : value;
        }

        // –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —à–∞—Ä–∏–Ω–≥–∞
        function updateShareState(numericAmount) {
            const isValidForSharing = (typeof numericAmount === 'number' && numericAmount >= 0.01);

            shareVkButton.disabled = !isValidForSharing;
            shareTelegramButton.disabled = !isValidForSharing;

            if (isValidForSharing) {
                const formattedAmountForDisplay = numericAmount.toLocaleString('ru-RU', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                const shareTextBase = `–¢–≤–æ—è –¥–æ–ª—è –∑–∞ –Ω–µ–¥–∞–≤–Ω–∏–µ –ø–æ—Å–∏–¥–µ–ª–∫–∏: ${formattedAmountForDisplay}‚ÇΩ üòä`;

                const shareUrlVk = `https://vk.com/share.php?title=${encodeURIComponent('–ü–æ–î–ï–õ–ò!: –°—É–º–º–∞ —á–µ–∫–∞')}&comment=${encodeURIComponent(shareTextBase)}`;
                const shareUrlTelegram = `https://t.me/share/url?url=${encodeURIComponent('–ü—Ä–∏–≤–µ—Ç! ')}&text=${encodeURIComponent(shareTextBase)}`;

                shareVkButton.onclick = () => window.open(shareUrlVk, '_blank', 'width=600,height=450,noopener,noreferrer');
                shareTelegramButton.onclick = () => window.open(shareUrlTelegram, '_blank', 'width=600,height=450,noopener,noreferrer');
            } else {
                shareVkButton.onclick = null;
                shareTelegramButton.onclick = null;
            }
        }
        
        // --- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—É–º–º—ã ---
        function loadAndDisplayLastProcessedAmount() {
            try {
                const storedAmountStr = localStorage.getItem(LAST_PROCESSED_AMOUNT_KEY);
                if (storedAmountStr !== null) {
                    const storedAmount = parseFloat(storedAmountStr);
                    if (!isNaN(storedAmount) && storedAmount >= 0) {
                        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å—É–º–º—É —Å –¥–≤—É–º—è –∑–Ω–∞–∫–∞–º–∏ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
                        const formattedAmount = storedAmount.toLocaleString('ru-RU', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                        lastAmountDisplay.textContent = formattedAmount;
                        lastAmountCard.style.display = 'block'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
                        copyLastAmountButton.disabled = false; // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
                        console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—É–º–º–∞ –∏–∑ localStorage: ${formattedAmount}`);
                        return; // –í—ã—Ö–æ–¥–∏–º, –µ—Å–ª–∏ —Å—É–º–º–∞ –Ω–∞–π–¥–µ–Ω–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞
                    } else {
                        console.warn("–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ lastProcessedTotalAmount –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º —á–∏—Å–ª–æ–º:", storedAmountStr);
                    }
                } else {
                    console.log("–ö–ª—é—á lastProcessedTotalAmount –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ localStorage.");
                }
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è lastProcessedTotalAmount –∏–∑ localStorage:", e);
            }

            // –ï—Å–ª–∏ —Å—É–º–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞, —Å–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ –∏ –≤—ã–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É
            lastAmountCard.style.display = 'none';
            copyLastAmountButton.disabled = true;
        }
        // --- –ö–æ–Ω–µ—Ü —Ñ—É–Ω–∫—Ü–∏–∏ ---

        // --- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—É–º–º—ã ---
        async function copyLastProcessedAmount() {
            const amountText = lastAmountDisplay.textContent;
            if (!amountText || copyLastAmountButton.disabled) {
                console.warn("–ù–µ—Ç —Å—É–º–º—ã –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞.");
                return;
            }

            // –£–±–∏—Ä–∞–µ–º —Å–∏–º–≤–æ–ª –≤–∞–ª—é—Ç—ã –∏ –ø—Ä–æ–±–µ–ª—ã –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏—Å—Ç–æ–≥–æ —á–∏—Å–ª–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
            // const amountToCopy = amountText.replace(/[‚ÇΩ\s]/g, '').replace(',', '.');
            // –ò–ª–∏ –∫–æ–ø–∏—Ä—É–µ–º –∫–∞–∫ –µ—Å—Ç—å —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –≤–∞–ª—é—Ç–æ–π:
            const amountToCopy = `${amountText} ‚ÇΩ`; // –ö–æ–ø–∏—Ä—É–µ–º —Å —Å–∏–º–≤–æ–ª–æ–º –≤–∞–ª—é—Ç—ã

            try {
                await navigator.clipboard.writeText(amountToCopy);
                const originalContent = copyLastAmountButton.innerHTML;
                const originalTitle = copyLastAmountButton.title;
                copyLastAmountButton.innerHTML = '‚úÖ'; // –ì–∞–ª–æ—á–∫–∞
                copyLastAmountButton.title = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                copyLastAmountButton.style.color = 'var(--primary-green)'; // –ó–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –≥–∞–ª–æ—á–∫–∏

                setTimeout(() => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –µ—â–µ –∫–Ω–æ–ø–∫–∞
                    const currentButton = document.getElementById('copyLastAmountBtn');
                    if (currentButton) {
                        currentButton.innerHTML = originalContent;
                        currentButton.title = originalTitle;
                        currentButton.style.color = ''; // –°–±—Ä–æ—Å —Ü–≤–µ—Ç–∞
                    }
                }, 1500);
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—É–º–º—ã: ', err);
                const originalContent = copyLastAmountButton.innerHTML;
                const originalTitle = copyLastAmountButton.title;
                copyLastAmountButton.innerHTML = '‚ùå'; // –ö—Ä–µ—Å—Ç–∏–∫
                copyLastAmountButton.title = '–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è';
                copyLastAmountButton.style.color = 'var(--error-color)'; // –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –æ—à–∏–±–∫–∏

                setTimeout(() => {
                    const currentButton = document.getElementById('copyLastAmountBtn');
                    if (currentButton) {
                        currentButton.innerHTML = originalContent;
                        currentButton.title = originalTitle;
                        currentButton.style.color = ''; // –°–±—Ä–æ—Å —Ü–≤–µ—Ç–∞
                    }
                }, 2000);
            }
        }

        // --- Helper Function removed (formatInputVisually logic moved into 'change' listener) ---

        // --- Initial Setup ---
        const urlParams = new URLSearchParams(window.location.search);
        const initialAmountParam = urlParams.get('amount');
        let initialParsedAmount = parseAmount(initialAmountParam);
        let initialNumericValue;

        // Apply the minimum threshold logic for initial amount as well
        if (initialParsedAmount !== null && initialParsedAmount > 0 && initialParsedAmount < 0.01) {
            initialNumericValue = 0; // Treat initial small fractions as 0
        } else if (initialParsedAmount !== null && initialParsedAmount >= 0.01) {
            initialNumericValue = initialParsedAmount; // Use valid initial amount
        } else {
            initialNumericValue = 0; // Default to 0
        }

        // Set initial input value formatted
        amountInput.value = initialNumericValue.toFixed(2);
        // Set initial button state based on the potentially adjusted initial amount
        updateShareState(initialNumericValue);

        // –í—ã–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—É–º–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadAndDisplayLastProcessedAmount();
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
        copyLastAmountButton.addEventListener('click', copyLastProcessedAmount);

        // --- Event Listeners ---
        // –°–ª—É—à–∞—Ç–µ–ª—å 'input': –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —á–∏—Å—Ç–∫–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ *–≤–æ –≤—Ä–µ–º—è –≤–≤–æ–¥–∞*
        amountInput.addEventListener('input', (event) => {
            let value = event.target.value;
            // –£–±–∏—Ä–∞–µ–º –≤—Å–µ, –ö–†–û–ú–ï —Ü–∏—Ñ—Ä, —Ç–æ—á–∫–∏, –∑–∞–ø—è—Ç–æ–π
            let cleanedValue = value.replace(/[^0-9.,]/g, '');

            // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ (–º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å)
            const separators = (cleanedValue.match(/[.,]/g) || []).length;
            if (separators > 1) {
                // –ï—Å–ª–∏ –≤–≤–µ–ª–∏ –≤—Ç–æ—Ä–æ–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å, –ø—ã—Ç–∞–µ–º—Å—è –µ–≥–æ —É–±—Ä–∞—Ç—å (–Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ, –Ω–æ –ª—É—á—à–µ —á–µ–º –Ω–∏—á–µ–≥–æ)
                 const firstSeparatorIndex = cleanedValue.search(/[.,]/);
                 if (firstSeparatorIndex !== -1) {
                     const integerPart = cleanedValue.substring(0, firstSeparatorIndex + 1);
                     const fractionalPart = cleanedValue.substring(firstSeparatorIndex + 1).replace(/[.,]/g, '');
                     cleanedValue = integerPart + fractionalPart;
                 }
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–æ–ª–µ, –µ—Å–ª–∏ –æ–Ω–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –ø–æ—Å–ª–µ —á–∏—Å—Ç–∫–∏
            if (event.target.value !== cleanedValue) {
                const start = event.target.selectionStart;
                const diff = event.target.value.length - cleanedValue.length;
                event.target.value = cleanedValue;
                // –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞
                try { event.target.setSelectionRange(start - diff, start - diff); } catch(e) {}
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ *–ø–æ–ø—ã—Ç–∫–∏* –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
            // parseAmount —Å–ø—Ä–∞–≤–∏—Ç—Å—è —Å –∑–∞–ø—è—Ç–æ–π/—Ç–æ—á–∫–æ–π
            const parsedForState = parseAmount(cleanedValue);
            updateShareState(parsedForState);
        });

        // –°–ª—É—à–∞—Ç–µ–ª—å 'change': –§–∏–Ω–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å–ª–µ –ø–æ—Ç–µ—Ä–∏ —Ñ–æ–∫—É—Å–∞ –∏–ª–∏ Enter (–≤–∫–ª—é—á–∞—è –≤—Å—Ç–∞–≤–∫—É)
        amountInput.addEventListener('change', (event) => {
            const parsedValue = parseAmount(event.target.value); // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–ª—É—á—à–µ–Ω–Ω—ã–π parseAmount
            let finalNumericValue;

            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ—Ä–æ–≥ 0.01
            if (parsedValue !== null && parsedValue > 0 && parsedValue < 0.01) {
                finalNumericValue = 0;
            } else if (parsedValue !== null && parsedValue >= 0.01) {
                finalNumericValue = parsedValue;
            } else {
                finalNumericValue = 0; // NaN, null, < 0 –∏–ª–∏ 0 -> 0
            }

            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –¥–æ –¥–≤—É—Ö –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
            amountInput.value = finalNumericValue.toFixed(2);

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
            updateShareState(finalNumericValue);
        });

        // --- Paste Button Code Removed ---

    </script>
</body>
</html>