<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ü–æ–î–ï–õ–ò! - –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —á–µ–∫–æ–º</title>
    <style>
        /* Sber-inspired Palette */
        :root {
            --primary-green: #08a552; /* Main green */
            --accent-green-yellow: #9fe61f; /* Bright green/yellow */
            --accent-teal: #42e3b4; /* Lighter teal/green */
            --text-dark: #1a1a1a; /* Darker than pure black for text */
            --text-light: #ffffff;
            --card-background: #ffffff; /* White background for the card */
            --border-gradient: linear-gradient(135deg, var(--primary-green), var(--accent-green-yellow)); /* Gradient for the border */
            --button-hover-opacity: 0.85;
            --shadow-color: rgba(8, 165, 82, 0.15); /* Shadow based on primary green */
            --border-thickness: 3px; /* Control border thickness */
            --widget-border-radius: 18px; /* Consistent rounding */
            --disabled-button-bg: #aabbcc; /* Grey for disabled buttons */
        }

        /* Make body a flex container to push content down */
        body {
            font-family: 'Arial', sans-serif;
            padding: 25px 20px; /* Keep padding for spacing from screen edges */
            color: var(--text-dark);
            background-image: url("/static/images/splash.png"); /* Combined background style */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;

            /* Flexbox for bottom alignment */
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Ensure body takes full viewport height */
            justify-content: flex-end; /* Push flex items (header, cards) to the bottom */
            box-sizing: border-box; /* Include padding in min-height calculation */
            margin: 0; /* Reset default margin */
        }

        /* Apply max-width and centering to the main content blocks */
        .header,
        .widget-bordered { /* Target the main blocks */
            max-width: 600px; /* Set the max width */
            width: 100%; /* Ensure they take available width up to max-width */
            margin-left: auto; /* Center the blocks */
            margin-right: auto; /* Center the blocks */
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }
        .header div:not(.logo) {
            font-size: 16px;
            color: var(--text-dark);
            opacity: 0.9;
        }

        /* Outer container for border and shadow */
        .widget-bordered {
            border-radius: var(--widget-border-radius);
            box-shadow: 0 5px 20px var(--shadow-color);
            position: relative;
            z-index: 1;
            overflow: hidden;
            padding: var(--border-thickness);
        }

        /* Adjust margins between the cards */
        .receipt-card {
             margin-bottom: 25px; /* Space between receipt and share card */
        }
        .share-section {
             margin-bottom: 40px; /* Add some space at the very bottom */
        }


        /* Gradient Border using ::before */
        .widget-bordered::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border-gradient);
            z-index: -1;
            border-radius: inherit;
        }

        /* Inner container for white background and content padding */
        .widget-content {
            background-color: var(--card-background);
             border-radius: calc(var(--widget-border-radius) - var(--border-thickness));
             padding: 25px;
             height: 100%;
             box-sizing: border-box;
        }


        /* Specific styles for receipt card */
        .receipt-card {
             /* Inherits .widget-bordered styles */
        }

        /* Adjust padding for the inner content */
         .receipt-card .widget-content {
             padding: 25px;
         }

        .receipt-title {
            font-size: 22px;
            margin-bottom: 20px;
            text-align: center;
            color: var(--primary-green);
            font-weight: 600;
        }

        .amount-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px; /* Adjust gap if needed after removing button */
            flex-wrap: wrap;
            margin-top: 30px;
            margin-bottom: 30px;
        }

        #receiptAmountInput {
            font-size: 42px;
            font-weight: bold;
            color: var(--primary-green);
            border: 2px solid var(--primary-green);
            border-radius: 10px;
            padding: 8px 12px;
            width: auto;
            min-width: 120px;
            max-width: 220px; /* Might want to adjust max-width */
            text-align: right;
            background-color: #fdfdfd;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            -webkit-appearance: none; /* Keep this for iOS */
            margin: 0;
            -moz-appearance: textfield; /* For Firefox */
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        #receiptAmountInput:focus {
            outline: none;
            border-color: var(--accent-green-yellow);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05), 0 0 5px var(--accent-green-yellow);
        }
        /* Hide arrows for number input */
        #receiptAmountInput::-webkit-outer-spin-button,
        #receiptAmountInput::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .currency-symbol {
            font-size: 42px;
            font-weight: bold;
            color: var(--primary-green);
            padding-left: 5px;
        }

        /* Specific styles for share section */
        .share-section {
            /* Inherits .widget-bordered styles */
        }

        /* Adjust padding for the inner content */
         .share-section .widget-content {
             padding: 20px; /* Slightly less padding */
         }


        .share-title {
            margin-bottom: 20px;
            font-size: 20px;
            color: var(--primary-green);
            font-weight: 600;
            text-align: center;
        }

        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .share-button {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            color: var(--text-light);
            font-weight: bold;
            font-size: 15px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: opacity 0.3s, transform 0.2s, box-shadow 0.3s, background-color 0.3s;
            background-color: var(--primary-green);
            box-shadow: 0 3px 8px var(--shadow-color);
            min-width: 150px;
        }

        .share-button:hover:not(:disabled) { /* Apply hover only if not disabled */
            opacity: var(--button-hover-opacity);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px var(--shadow-color);
        }
         .share-button:active:not(:disabled) { /* Apply active only if not disabled */
            transform: translateY(0px);
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        /* --- Styles for Disabled Share Buttons --- */
        .share-button:disabled {
            background-color: var(--disabled-button-bg); /* Greyed out background */
            opacity: 0.6; /* Reduce opacity */
            cursor: not-allowed; /* Indicate non-clickable */
            box-shadow: none; /* Remove shadow */
            transform: none; /* Prevent hover transform */
        }

        .share-button:disabled:hover { /* Keep disabled style on hover */
            opacity: 0.6;
            transform: none;
            box-shadow: none;
        }
        /* --- End Disabled Styles --- */

        .icon {
            width: 22px;
            height: 22px;
        }
        /* --- AMOLED Dark Theme --- */
        @media (prefers-color-scheme: dark) {

        /* –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã */
        :root {
            /* –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞ */
            --primary-green-dark: #12c26a;       /* –ë–æ–ª–µ–µ —è—Ä–∫–∏–π –∑–µ–ª–µ–Ω—ã–π –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ */
            --accent-green-yellow-dark: #c8ff4d; /* –ë–æ–ª–µ–µ —è—Ä–∫–∏–π –∞–∫—Ü–µ–Ω—Ç */
            --text-light-dark-theme: #000000; /* –ß–µ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –Ω–∞ —Å–≤–µ—Ç–ª–æ–º —Ñ–æ–Ω–µ) */
            --card-background-dark: #000000;    /* –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω –≤–∏–¥–∂–µ—Ç–æ–≤ */
            --body-background-dark: #000000;     /* –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
            --input-background-dark: #1f1f1f;   /* –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–π —Ñ–æ–Ω –∏–Ω–ø—É—Ç–æ–≤ */
            --border-gradient: linear-gradient(135deg, var(--primary-green), var(--accent-green-yellow)); /* Gradient for the border */
            --border-thickness: 3px; /* Control border thickness */
            --shadow-color-dark: rgba(180, 180, 180, 0.1); /* –û—á–µ–Ω—å –ª–µ–≥–∫–∞—è —Å–≤–µ—Ç–ª–∞—è —Ç–µ–Ω—å */
            --disabled-button-bg-dark: #3a3a3a; /* –§–æ–Ω –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ */
            --disabled-button-text-dark: #888888; /* –¢–µ–∫—Å—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ */
        }

        body {
            background-color: var(--body-background-dark);
            color: var(--text-dark-theme);
            /* –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∑–∞—Ç–µ–º–Ω–∏—Ç—å —Ñ–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
            /* background-image: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url("/static/images/splash.png"); */
        }

        .header .logo,
        .header div:not(.logo) {
            color: var(--text-dark-theme);
            text-shadow: none; /* –£–±–∏—Ä–∞–µ–º —Å–≤–µ—Ç–ª—É—é —Ç–µ–Ω—å */
        }

        /* –í–Ω–µ—à–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∏–¥–∂–µ—Ç–∞ */
        .widget-bordered {
            box-shadow: 0 5px 20px var(--shadow-color-dark);
            padding: var(--border-thickness); /* –í–ï–†–ù–£–¢–¨ –≠–¢–£ –°–¢–†–û–ö–£ */

        }



        /* –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º */
        .widget-content {
            background-color: var(--card-background-dark);
            /* –°–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–µ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É */
            border-radius: calc(var(--widget-border-radius) - var(--border-thickness));
            /* –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏ (—á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∏–∂–µ) */
        }
        /* –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –ø–∞–¥–¥–∏–Ω–≥–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è (–æ–Ω–∏ –±—ã–ª–∏ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ –¥–ª—è .widget-content) */
        .receipt-card .widget-content { padding: 25px; }
        .share-section .widget-content { padding: 20px; }


        /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤–∏–¥–∂–µ—Ç–æ–≤ */
        .receipt-title,
        .share-title {
            color: var(--primary-green-dark); /* –Ø—Ä–∫–∏–π –∑–µ–ª–µ–Ω—ã–π */
        }

        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å—É–º–º—ã */
        #receiptAmountInput {
            background-color: var(--input-background-dark);
            border: 2px solid var(--border-dark); /* –¢–µ–º–Ω–∞—è —Ä–∞–º–∫–∞ */
            box-shadow: none; /* –£–±–∏—Ä–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ç–µ–Ω—å */
        }
        #receiptAmountInput:focus {
            border-color: var(--primary-green-dark);
            box-shadow: inset 0 1px 2px rgba(255,255,255,0.03), 0 0 5px var(--primary-green-dark); /* –õ–µ–≥–∫–∞—è –≤–Ω–µ—à–Ω—è—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ */
        }


        /* –ö–Ω–æ–ø–∫–∏ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" */
        .share-button {
            /* –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –∑–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç –∫–Ω–æ–ø–∫–∏, –æ–Ω –∫–æ–Ω—Ç—Ä–∞—Å—Ç–µ–Ω */
            background-color: var(--primary-green); /* –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∑–µ–ª–µ–Ω—ã–π */
            color: var(--text-light); /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç –æ—Å—Ç–∞–µ—Ç—Å—è */
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4); /* –¢–µ–º–Ω–∞—è —Ç–µ–Ω—å */
        }
        .share-button:hover:not(:disabled) {
            /* opacity: var(--button-hover-opacity); */ /* –û—Å—Ç–∞–≤–ª—è–µ–º */
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.5); /* –£—Å–∏–ª–µ–Ω–Ω–∞—è —Ç–µ–º–Ω–∞—è —Ç–µ–Ω—å */
        }
        .share-button:active:not(:disabled) {
            transform: translateY(0px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
        }

        /* –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
        .share-button:disabled {
            background-color: var(--disabled-button-bg-dark);
            color: var(--disabled-button-text-dark);
            opacity: 0.7; /* –ß—É—Ç—å –º–µ–Ω–µ–µ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ */
            box-shadow: none;
        }
        .share-button:disabled:hover { /* –°—Ç–∏–ª–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—É—é */
            opacity: 0.7;
            transform: none;
            box-shadow: none;
        }

        /* –ò–∫–æ–Ω–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–Ω–æ–ø–æ–∫ —É–∂–µ –∏–º–µ—é—Ç fill="white" –≤ HTML, —á—Ç–æ –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç */

        } /* –ö–æ–Ω–µ—Ü @media (prefers-color-scheme: dark) */
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">–ü–æ–î–ï–õ–ò!</div>
        <div>–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—É–º–º–æ–π –∏–∑ —á–µ–∫–∞ –ª–µ–≥–∫–æ</div>
    </div>

    <!-- Receipt Card with Gradient Border -->
    <div class="receipt-card widget-bordered">
        <div class="widget-content">
            <div class="receipt-title">–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É —á–µ–∫–∞</div> <!-- Updated title -->
            <div class="amount-container">
                 <!-- Input type=text might offer more control over input behavior than type=number -->
                 <!-- Use inputmode="decimal" for mobile keyboards -->
                 <input type="text" inputmode="decimal" id="receiptAmountInput" value="0.00" placeholder="0.00">
                 <span class="currency-symbol">‚ÇΩ</span>
                 <!-- Paste button removed -->
            </div>
        </div>
    </div>

    <!-- Share Section with Gradient Border -->
    <div class="share-section widget-bordered">
        <div class="widget-content">
            <div class="share-title">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—É–º–º–æ–π</div>
            <div class="share-buttons">
                <!-- VK Button - Initially might be disabled -->
                <button class="share-button" id="shareVk">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                        <path d="M15.07 2H8.93C3.33 2 2 3.33 2 8.93V15.07C2 20.67 3.33 22 8.93 22H15.07C20.67 22 22 20.67 22 15.07V8.93C22 3.33 20.67 2 15.07 2M18.15 16.27H16.69C16.14 16.27 15.97 15.82 15 14.83C14.12 13.94 13.74 13.71 13.53 13.71C13.24 13.71 13.15 13.83 13.15 14.38V15.69C13.15 16.04 13.04 16.26 12.11 16.26C10.57 16.26 8.86 15.32 7.66 13.59C5.85 11.05 5.36 9.13 5.36 8.75C5.36 8.54 5.43 8.34 5.85 8.34H7.32C7.69 8.34 7.83 8.5 7.97 8.9C8.69 11 9.89 12.8 10.38 12.8C10.57 12.8 10.65 12.71 10.65 12.25V10.1C10.6 9.12 10.07 9.03 10.07 8.68C10.07 8.5 10.21 8.34 10.44 8.34H12.73C13.04 8.34 13.15 8.5 13.15 8.88V11.77C13.15 12.08 13.28 12.19 13.38 12.19C13.56 12.19 13.72 12.08 14.05 11.74C15.1 10.57 15.85 8.76 15.85 8.76C15.95 8.55 16.11 8.35 16.5 8.35H17.93C18.37 8.35 18.47 8.58 18.37 8.89C18.19 9.74 16.41 12.25 16.43 12.25C16.27 12.5 16.21 12.61 16.43 12.9C16.58 13.11 17.09 13.55 17.43 13.94C18.05 14.65 18.53 15.24 18.66 15.65C18.77 16.06 18.57 16.27 18.15 16.27Z"/>
                    </svg>
                    –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
            </button>

            <!-- Telegram Button - Initially might be disabled -->
            <button class="share-button" id="shareTelegram">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                    <path d="M9.78,18.65L10.06,14.42L17.74,7.5C18.08,7.19 17.67,7.04 17.22,7.31L7.74,13.3L3.64,12C2.76,11.75 2.75,11.14 3.84,10.7L19.81,4.54C20.54,4.21 21.24,4.72 20.96,5.84L18.24,18.65C18.05,19.56 17.5,19.78 16.74,19.36L12.6,16.3L10.61,18.23C10.38,18.46 10.19,18.65 9.78,18.65Z"/>
                </svg>
                Telegram
            </button>
        </div>
        </div>
    </div>

    <script>
        // Get references to elements
        const amountInput = document.getElementById('receiptAmountInput');
        const shareVkButton = document.getElementById('shareVk');
        const shareTelegramButton = document.getElementById('shareTelegram');


        function parseAmount(text) {
            if (text === null || text === undefined || text === '') return null;
            // Allow spaces, replace comma, remove invalid chars except dot
            let cleanedText = String(text).replace(/\s/g, '').replace(',', '.').replace(/[^0-9.]/g, '');

            // Ensure only one decimal point exists
            const parts = cleanedText.split('.');
            if (parts.length > 2) {
                 // Reconstruct with only the first decimal point
                 cleanedText = parts[0] + '.' + parts.slice(1).join('');
            }
             // If it ends with just '.', treat it as integer for now during typing
             if (cleanedText.endsWith('.') && cleanedText.length > 1) {
                  // Allow typing e.g. "12." without immediately parsing as NaN
                  // But parseFloat will handle this correctly anyway
             } else if (cleanedText === '.') {
                return 0; // Treat just "." as 0 for parsing purpose
             }


            const value = parseFloat(cleanedText);
            // Return null if NaN or negative
            return isNaN(value) || value < 0 ? null : value;
        }

        // Updates share button state and links based on a numeric value
        function updateShareState(numericAmount) {
            // Buttons enabled only if >= 0.01
            // Check if numericAmount is a valid number and meets the minimum threshold
            const isValidForSharing = (typeof numericAmount === 'number' && numericAmount >= 0.01);

            // --- Button Enabling/Disabling Logic ---
            shareVkButton.disabled = !isValidForSharing;
            shareTelegramButton.disabled = !isValidForSharing;
            // --- End Button Logic ---

            // Only generate share links and set handlers if the amount is valid for sharing
            if (isValidForSharing) {
                // Format for display in the message, always 2 decimals
                // No need to re-check the value here, as it's already >= 0.01
                const formattedAmountForDisplay = numericAmount.toLocaleString('ru-RU', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                const shareTextBase = `–¢–≤–æ—è –¥–æ–ª—è –∑–∞ –Ω–µ–¥–∞–≤–Ω–∏–µ –ø–æ—Å–∏–¥–µ–ª–∫–∏: ${formattedAmountForDisplay}‚ÇΩ üòä`; // Simplified text

                const shareUrlVk = `https://vk.com/share.php?title=${encodeURIComponent('–ü–æ–î–ï–õ–ò!: –°—É–º–º–∞ —á–µ–∫–∞')}&comment=${encodeURIComponent(shareTextBase)}`;
                const shareUrlTelegram = `https://t.me/share/url?url=${encodeURIComponent('–ü—Ä–∏–≤–µ—Ç! ')}&text=${encodeURIComponent(shareTextBase)}`;

                shareVkButton.onclick = () => window.open(shareUrlVk, '_blank', 'width=600,height=450,noopener,noreferrer');
                shareTelegramButton.onclick = () => window.open(shareUrlTelegram, '_blank', 'width=600,height=450,noopener,noreferrer');
            } else {
                // Clear onclick handlers when buttons are disabled
                shareVkButton.onclick = null;
                shareTelegramButton.onclick = null;
            }
        }

        // --- Helper Function removed (formatInputVisually logic moved into 'change' listener) ---

        // --- Initial Setup ---
        const urlParams = new URLSearchParams(window.location.search);
        const initialAmountParam = urlParams.get('amount');
        let initialParsedAmount = parseAmount(initialAmountParam);
        let initialNumericValue;

        // Apply the minimum threshold logic for initial amount as well
        if (initialParsedAmount !== null && initialParsedAmount > 0 && initialParsedAmount < 0.01) {
            initialNumericValue = 0; // Treat initial small fractions as 0
        } else if (initialParsedAmount !== null && initialParsedAmount >= 0.01) {
            initialNumericValue = initialParsedAmount; // Use valid initial amount
        } else {
            initialNumericValue = 0; // Default to 0
        }

        // Set initial input value formatted
        amountInput.value = initialNumericValue.toFixed(2);
        // Set initial button state based on the potentially adjusted initial amount
        updateShareState(initialNumericValue);


        // --- Event Listeners ---
        amountInput.addEventListener('input', (event) => {
            // Filter input to allow only digits and one decimal point using regex replacement
            let value = event.target.value;
            value = value.replace(/[^0-9.]/g, ''); // Remove invalid chars
             const parts = value.split('.');
             if (parts.length > 2) { // If more than one dot
                 value = parts[0] + '.' + parts.slice(1).join(''); // Keep only first dot
             }

             // Update input value *if* it was cleaned
             if (event.target.value !== value) {
                // Store cursor position
                const start = event.target.selectionStart;
                const end = event.target.selectionEnd;
                event.target.value = value;
                // Restore cursor position (relative to changes)
                // This might not be perfect if characters were removed before the cursor
                event.target.setSelectionRange(start - (event.target.value.length - value.length), end - (event.target.value.length - value.length));
             }

            // Parse the current (potentially unformatted) value for state update
            const parsedForState = parseAmount(value);
            // Update button state based on live value, checking the >= 0.01 threshold
            updateShareState(parsedForState); // Update button state based on live value
        });

         amountInput.addEventListener('change', (event) => {
            // User finished editing (blur/enter). Now format, enforce minimum, and sync state.
            const parsedValue = parseAmount(event.target.value);
            let finalNumericValue;

            // Determine the final numeric value, enforcing the 0.01 minimum threshold
            if (parsedValue !== null && parsedValue > 0 && parsedValue < 0.01) {
                // If the value is positive but less than 0.01, treat it as 0.
                finalNumericValue = 0;
            } else if (parsedValue !== null && parsedValue >= 0.01) {
                // If the value is 0.01 or more, use it.
                finalNumericValue = parsedValue;
            } else {
                // Otherwise (negative, NaN, or exactly 0 initially), treat as 0.
                finalNumericValue = 0;
            }

            // Format the input field visually based on the final corrected value
            amountInput.value = finalNumericValue.toFixed(2);

            // Update share state based on the final corrected numeric value
            updateShareState(finalNumericValue);
         });

        // --- Paste Button Code Removed ---

    </script>
</body>
</html>